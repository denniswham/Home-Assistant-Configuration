  - id: 3c28420d-2670-4215-bd93-7b2ca445fbb4
    alias: '[Alarm] Arm Konnected'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: not
        conditions:
          - condition: state
            entity_id: alarm_control_panel.konnected_alarm
            state: armed_away
    trigger:
      - platform: state
        entity_id: group.household
        from: home
        to: not_home
    action:
      - service: switch.turn_off
        entity_id: switch.siren
      - service: switch.turn_off
        entity_id: switch.backyard_siren
      - service: alarm_control_panel.alarm_arm_away
        entity_id:
          - alarm_control_panel.konnected_alarm
          - alarm_control_panel.alexa_guard_7514f
      - service: notify.alexa_media
        data:
          data:
            type: announce
          target:
          - group.alexa
          message: I'll start guarding now

  # - id: f586bfa3-cec3-4881-8cbb-bb2ceb9aea62
  #   alias: '[Alarm] Deactivate siren'
  #   initial_state: 'true'
  #   condition:
  #     condition: or
  #     conditions:
  #       - condition: state
  #         entity_id: switch.siren
  #         state: 'on'
  #       - condition: state
  #         entity_id: switch.backyard_siren
  #         state: 'on'
  #   trigger:
  #     - platform: state
  #       entity_id: alarm_control_panel.konnected_alarm
  #       to: triggered
  #       for: 00:20:00
  #     - platform: state
  #       entity_id: alarm_control_panel.konnected_alarm
  #       to: disarmed
  #   action:
  #     - service: switch.turn_off
  #       entity_id: switch.siren
  #     - service: switch.turn_off
  #       entity_id: switch.backyard_siren

  - id: 2d57cc0c-7317-486f-a2f2-b755c59ac660
    alias: '[Alarm] Disarm Konnected at night'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: alarm_control_panel.konnected_alarm
        state: armed_home
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
    trigger:
      - platform: zone
        entity_id:
          - person.dennis
          - person.stephanie
          - person.lucas
          - person.timo
        zone: zone.home
        event: enter
    action:
      - service: script.turn_on
        entity_id: script.konnectedstandby

  - id: d4ce8893-a219-499b-bd45-18a2bc5bc6c2
    alias: '[Alarm] Disarm Konnected from Away'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: alarm_control_panel.konnected_alarm
        state: armed_away
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    action:
      - service: script.turn_on
        entity_id: script.konnectedstandby

  - id: b937f244-4e93-4ab7-9310-a1c77a7c05d4
    alias: '[Alarm] Disarm Konnected in the morning'
    initial_state: 'true'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.household
          state: home
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
    trigger:
      - platform: time
        at: 06:00:00
    action:
      - service: script.turn_on
        entity_id: script.konnectedstandby

  - id: 8efa2a7d-23c9-4bb3-b163-4e1bf820976d
    alias: '[Alarm] Konnected Standby'
    initial_state: 'true'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.household
          state: home
        - condition: time
          after: 06:15:00
          before: '21:00:00'
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: alarm_control_panel.konnected_alarm
            state: armed_home
          - condition: state
            entity_id: alarm_control_panel.konnected_alarm
            state: armed_away
    trigger:
      - platform: time_pattern
        minutes: /10
        seconds: 0
    action:
      - service: script.turn_on
        entity_id: script.konnectedstandby

  - id: 72a6ac29-9e75-4f47-a22b-407609b26ee9
    alias: '[Alarm] Konnected Log Motion'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: binary_sensor.entryway
        to: 'on'
      - platform: state
        entity_id: binary_sensor.kitchen
        to: 'on'
      - platform: state
        entity_id: binary_sensor.living_room
        to: 'on'
      - platform: state
        entity_id: binary_sensor.office
        to: 'on'
      - platform: state
        entity_id: binary_sensor.garage
        to: 'on'
      - platform: state
        entity_id: binary_sensor.backyard_motion
        to: 'on'
    condition:
      condition: not
      conditions:
        - condition: state
          entity_id: alarm_control_panel.konnected_alarm
          state: disarmed
    action:
      - service: logbook.log
        data_template:
          name: "Motion detected: "
          message: >-
            {{ trigger.entity_id }}

  - id: 0c082214-fab9-4833-9efc-7f220b337811
    alias: '[Alarm] Trigger Alarm'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.konnected_alarm
        to: triggered
    action:
      - service: switch.turn_on
        entity_id: switch.siren
      - service: switch.turn_on
        entity_id: switch.backyard_siren
      - service: scene.turn_on
        entity_id: scene.emergency
      - service: notify.alexa_media
        data:
          data:
            type: announce
          target:
            - group.alexa
          message: Your alarm was activated
      - service: notify.all_devices
        data:
          title: Konnected
          message: Your alarm was activated
          data:
            ttl: 0
            priority: high      
            channel: Alarm
            tag: alarm
            sticky: 'true'
            color: 'red'
            push:
            thread-id: "alarm"
            presentation_options:
              - alert
              - badge

  - id: 583df5d2-69c7-49e2-93a2-0c49d936b0fb
    alias: '[Alarm] Pending alarm'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.entryway
          - binary_sensor.kitchen
          - binary_sensor.living_room
          - binary_sensor.office
          - binary_sensor.garage
        to: 'on'
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: alarm_control_panel.konnected_alarm
          state: armed_away
        - condition: state
          entity_id: alarm_control_panel.konnected_alarm
          state: armed_home
    action:
      - service: alarm_control_panel.alarm_trigger
        entity_id: alarm_control_panel.konnected_alarm
      - service: notify.alexa_media
        data:
          data:
            type: announce
          target:
            - group.alexa
          message: Motion detected, the alarm will activate shortly. Motion detected, the alarm will activate shortly.

  - id: 811e963d-f24e-47bd-b0fb-b519bb0e6dbb
    alias: '[Climate] Away Mode'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: group.household
        from: home
        to: not_home
    action:
      - service: climate.set_preset_mode
        entity_id:
          - climate.living_room
        data: {"preset_mode": "away"}

  - id: 039d5bb6-5335-4c0c-9c37-c0d286bcecae
    alias: '[Climate] Home Mode'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    action:
      - service: climate.set_preset_mode
        entity_id:
          - climate.living_room
        data: {"preset_mode": "home"}

  - id: 763d3d6d-c8f2-473b-86ed-ad6d41ff0083
    alias: '[Climate] Disable thermostat away'
    initial_state: 'true'
    condition:
      - condition: not
        conditions:
          - condition: state
            entity_id: alarm_control_panel.konnected_alarm
            state: armed_away
      - condition: state
        entity_id: binary_sensor.retsinagaard_away
        state:  'on'
    trigger:
      - platform: time_pattern
        minutes: /5
        seconds: 0
    action:
      - service: climate.set_preset_mode
        entity_id:
          - climate.living_room
        data: {"preset_mode": "home"}

  - id: e7d7fec6-be05-4aa2-bdd5-e8b2a4c585e7
    alias: '[Climate] Enable thermostat away'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: alarm_control_panel.konnected_alarm
        state:  armed_away
      - condition: state
        entity_id: binary_sensor.retsinagaard_away
        state:  'off'
    trigger:
      - platform: time_pattern
        minutes: /5
        seconds: 0
    action:
      - service: climate.set_preset_mode
        entity_id:
          - climate.living_room
        data: {"preset_mode": "away"}

  - id: 82e04eda-e291-4af7-be6f-f6ec33719802
    alias: '[Climate] Set thermostat ETA'
    initial_state: 'true'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.household
          state: not_home
        - condition: state
          entity_id: binary_sensor.retsinagaard_away
          state: 'on'
    trigger:
      - platform: template
        value_template: "{%- if is_state_attr('proximity.home', 'dir_of_travel', 'towards')\
          \ -%}\n  true\n{%- endif -%}\n"
    action:
      - service: nest.set_eta
        data_template:
          eta: >
            {% if is_state_attr('proximity.home', 'nearest', 'Dennis') %}
              {{ ((( states.sensor.dennis_to_home.state | int) * 60) - 3600) | timestamp_custom('%H:%M:%S') }}
            {% elif is_state_attr('proximity.home', 'nearest', 'Dennis, Stephanie') %}
              {{ ((( states.sensor.dennis_to_home.state | int) * 60) - 3600) | timestamp_custom('%H:%M:%S') }}
            {% elif is_state_attr('proximity.home', 'nearest', 'Stephanie') %}
              {{ ((( states.sensor.stephanie_to_home.state | int) * 60) - 3600) | timestamp_custom('%H:%M:%S') }}
            {% endif %}
          eta_window: 00:01
          trip_id: ETA set by HAS
          structure:
            - Retsinagaard

  - id: d2851e95-9ef6-49bf-973d-9ed51545414c
    alias: '[Climate] Cancel thermostat ETA'
    initial_state: 'true'
    condition:
      - condition: not
        conditions:
          - condition: state
            entity_id: sensor.retsinagaard_eta
            state: "1970-01-01 00:00:00+00:00"
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
      - platform: template
        value_template: "{% if is_state_attr('proximity.home', 'dir_of_travel', 'towards') %}false{% endif %}"
        for: '00:10:00'
    action:
      - service: nest.cancel_eta
        data:
          trip_id: ETA set by HAS
          structure:
            - Retsinagaard
      - service: climate.set_preset_mode
        entity_id:
          - climate.living_room
        data: {"preset_mode": "home"}

  - id: f22881d0-2a37-46f6-86fa-0feaac19de59
    alias: '[Covers] Open Master Bedroom roller shutter in the morning'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: state
        entity_id: group.household
        state: 'home'
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
    trigger:
      - platform: time
        at: "08:30:00"
    action:
      - service: cover.open_cover
        data:
          entity_id: cover.shelly_shsw_25_c4c964

  - id: 2c0fabaa-793e-4d83-a6f6-488b799384e7
    alias: '[Covers] Open Lucas Room roller shutter in the morning'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: state
        entity_id: group.household
        state: 'home'
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
    trigger:
      - platform: time
        at: "09:00:00"
    action:
      - service: cover.open_cover
        data:
          entity_id: cover.shelly_shsw_25_c4c695

  - id: 9168307a-6555-489d-b686-643216ff76e9
    alias: '[Covers] Open roller shutters in the morning during the weekends and holidays'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: state
        entity_id: group.household
        state: 'home'
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'off'
    trigger:
      - platform: time
        at: "11:00:00"
    action:
      - service: cover.open_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695

  - id: 58a2e68e-7adf-4d08-93d1-a4dd43faeb12
    alias: '[Covers] Close roller shutters in the evening'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: state
        entity_id: group.household
        state: 'home'
    trigger:
      - platform: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
    action:
      - service: cover.set_cover_position
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695
          position: 10

  - id: 36999f33-8fcb-423e-972d-425b4efca279
    alias: '[Covers] Close roller shutters with strong winds'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: state
        entity_id: sun.sun
        state: below_horizon
    trigger:
      - platform: numeric_state
        entity_id: sensor.br_wind_speed
        above: 35 #km/h
    action:
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695

  - id: d3a773bf-fc19-4f77-8ad7-00097a2a8bfa
    alias: '[Covers] Open roller shutters when arriving at daytime'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.br_temperature
        below: 25
      - condition: state
        entity_id: sun.sun
        state: above_horizon
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    action:
      - service: cover.open_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695

  - id: 9c7f65fd-fc67-47e1-a81d-e02afcacdc3e
    alias: '[Covers] Open roller shutters when arriving at night'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.br_temperature
        below: 25
      - condition: state
        entity_id: sun.sun
        state: below_horizon
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    action:
      - service: cover.set_cover_position
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695
          position: 10

  - id: 153b5394-3dde-4ebd-8e3f-4d2bb43e8529
    alias: '[Covers] Close covers when leaving'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
    trigger:
      - platform: state
        entity_id: group.household
        from: home
        to: not_home
    action:
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695
            - cover.shelly_shsw_25_c4c708

  - id: 6c9a2404-5bd8-43e4-beb2-c38afd7d21c5
    alias: '[Covers] Close roller shutters when high temperature'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
    trigger:
      - platform: numeric_state
        entity_id: sensor.br_temperature
        above: 25
    action:
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695

  - id: 94389708-c03d-43f9-9731-ec93ed511526
    alias: '[Covers] Close awning when expected heavy wind or rain'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: cover.shelly_shsw_25_c4c708
        state: open
    trigger:
      - platform: state
        entity_id: sensor.br_precipitation_forecast_total
        from: '0.0'
      - platform: numeric_state
        entity_id: sensor.br_wind_speed
        above: 35 #km/h
    action:
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c708

  - id: d030ba6f-ee63-4ee6-9cea-a43751aba57b
    alias: '[Covers] Close awning when no motion at night'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_motion
        from: "on"
        to: "off"
        for: "00:30:00"
    condition:
      - condition: state
        entity_id: cover.shelly_shsw_25_c4c708
        state: open
      - condition: state
        entity_id: sun.sun
        state: 'below_horizon'
    action:
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c708

  - id: 480cedf5-81f6-4321-a83b-f91981fe41e6
    alias: '[Covers] Closed awning'
    initial_state: 'true'
    condition:
      - condition: state
        entity_id: cover.shelly_shsw_25_c4c708
        state: open
      - condition: or
        conditions:
          - condition: not
            conditions:
              - condition: state
                entity_id: sensor.br_precipitation_forecast_total
                state: '0.0'
          - condition: numeric_state
            entity_id: sensor.br_wind_speed
            above: 35 #km/h
    trigger:
      - platform: time_pattern
        minutes: /5
        seconds: 0
    action:
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c708

  - id: 050a6124-23bb-4f5b-acde-e23e1c69361b
    alias: '[House] Reminder Guest Mode on'
    initial_state: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state:  'on'
    trigger:
      - platform: time
        at: "06:00:00"
    action:
      - service: notify.mobile_app_sm_g960f
        data:
          title: Guest Mode is still turned on
          message: Do you want to turn it off so that automations start working again?
          data:
            channel: Alert
            tag: alert
      - service: notify.mobile_app_iphone_van_stephanie
        data_template:
          title: Guest Mode is still turned on
          message: Do you want to turn it off so that automations start working again?
          data:
            push:
              thread-id: "alert"

  - id: 0fbfb0c5-7e5e-4964-8447-ebff3202d9c4
    alias: '[House] Guest Mode On'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: input_boolean.guest_mode
        to: 'on'
    action:
      - service: notify.mobile_app_sm_g960f
        data_template:
          title: Guest mode on
          message: Some automations turned off
          data:
            channel: Alert
            tag: alert
      - service: notify.mobile_app_iphone_van_stephanie
        data_template:
          title: Guest mode on
          message: Some automations turned off
          data:
            push:
              thread-id: "alert"

  - id: 380b5572-0d01-4a26-a61a-53cc9a1d679f
    alias: '[House] Guest Mode Off'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: input_boolean.guest_mode
        to: 'off'
    action:
      - service: notify.mobile_app_sm_g960f
        data:
          title: Guest mode off
          message: Automations turned on again
          data:
            channel: Alert
            tag: alert
      - service: notify.mobile_app_iphone_van_stephanie
        data_template:
          title: Guest mode off
          message: Automations turned on again
          data:
            push:
              thread-id: "alert"

  - id: e4519647-e24b-4f1b-8682-51aaa8ce4576
    alias: '[Lights] Turn on lights when arriving home at night'
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: state
        entity_id: sun.sun
        state: below_horizon
    action:
      - service: scene.turn_on
        entity_id: scene.dinner_time  

  - id: 11e9f0f4a-99b9-427c-85f7-b703a564a511
    alias: '[Lights] Turn off hallway and attic light after 10 minutes'
    trigger:
      - platform: state
        entity_id:
          - light.entryway_light
          - light.shelly_shsw_pm_f2f9bf
          - light.shelly_shsw_pm_b98825
        to: 'on'
        for: "00:10:00"
    condition:
    action:
      service: light.turn_off
      data_template:
        entity_id: "{{ trigger.entity_id }}"

  - id: d558b383-921e-4740-bafd-9a888b45fa9a
    alias: '[Lights] Turn on backyard lights when dark outside'
    trigger:
      - platform: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
    action:
      service: light.turn_on
      data_template:
        entity_id: >
          {% if (as_timestamp(now()) - as_timestamp(states.binary_sensor.backyard_motion.last_changed)) > 1800 %}
            light.shelly_shsw_pm_f27a0a
          {% else %}
            light.shelly_shsw_pm_f27a0a, light.shelly_shplg_s_8016cb
          {% endif %}

  - id: 0e58a3aa-8e64-4b24-bdba-b32dd6a68322
    alias: '[Lights] Turn off backyard garden lights after 30 minutes no motion'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_motion
        from: "on"
        to: "off"
        for: "00:30:00"
    condition:
      - condition: state
        entity_id: sun.sun
        state: 'below_horizon'
      - condition: time
        after: '16:30:00'
        before: '00:00:00'
    action:
      service: light.turn_off
      entity_id:
        - light.shelly_shplg_s_8016cb

  - id: 1802426d-6f61-4dde-ab2c-5cd3b5233243
    alias: '[Lights] Turn off backyard lights at midnight'
    trigger:
      platform: time
      at: "00:00:00"
    action:
      service: light.turn_off
      entity_id:
        - light.shelly_shsw_pm_f27a0a
        - light.shelly_shplg_s_8016cb

  - id: 0f21c88f-c82e-459d-81c5-c5cf170e6279
    alias: '[Lights] Turn on backyard lights when motion'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_motion
        to: 'on'
    condition:
      - condition: state
        entity_id: sun.sun
        state: 'below_horizon'
      - condition: time
        after: '00:00:01'
        before: '08:30:00'
    action:
      service: light.turn_on
      entity_id:
        - light.shelly_shsw_pm_f27a0a
        - light.shelly_shplg_s_8016cb

  - id: 5199be8b-2458-44b0-bd98-6bda33cd96f0
    alias: '[Lights] Turn off backyard lights when no motion'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_motion
        to: 'off'
        for: "00:10:00"
    condition:
      - condition: state 
        entity_id: sun.sun
        state: below_horizon
      - condition: time
        after: '00:00:01'
        before: '08:30:00'
    action:
      service: light.turn_off
      entity_id:
        - light.shelly_shsw_pm_f27a0a
        - light.shelly_shplg_s_8016cb

  - id: 27c20369-e108-462b-8c62-84999df3499c
    alias: '[Mockupancy] Turn on vacation mode'
    trigger:
      - platform: state
        entity_id: group.household
        to: not_home
        for:
          hours: 24
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.vacation_mode

  - id: 4757886e-74b9-4cfc-b888-845c757fea87
    alias: '[Power] Washing machine finished'
    trigger:
      - platform: state
        entity_id: binary_sensor.washing_machine_on
        from: "on"
        to: "off"
    action:
      # - service: notify.mobile_app_sm_g960f
      #   data:
      #     title: Washing machine
      #     message: The washing machine is finished
      #     data:
      #       channel: Laundry
      #       tag: laundry
      - service: notify.mobile_app_iphone_van_stephanie
        data:
          title: Washing machine
          message: The washing machine is finished
          data:
            push:
              thread-id: "laundry"

  - id: e18cf2bf-5c8a-4b4a-8add-10559655b7dd
    alias: '[Power] Tumble Dryer finished'
    trigger:
      - platform: state
        entity_id: binary_sensor.dryer_on
        from: "on"
        to: "off"
    action:
      # - service: notify.mobile_app_sm_g960f
      #   data:
      #     title: Tumble Dryer
      #     message: The tumble dryer is finished
      #     data:
      #       channel: Laundry
      #       tag: laundry
      - service: notify.mobile_app_iphone_van_stephanie
        data:
          title: Tumble Dryer
          message: The tumble dryer is finished
          data:
            push:
              thread-id: "laundry"

  - id: 2ae00756-b4a9-4068-acc8-c574a8a60fd4
    alias: '[Motion]  Motion in backyard at night'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_motion
        to: 'on'
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: alarm_control_panel.konnected_alarm
          state: armed_away
        - condition: time
          after: '00:00:00'
          before: '07:00:00'
    action:
      - service: notify.alexa_media
        data:
          data:
            type: announce
          target:
            - group.alexa
          message: "Motion in the backyard"
      - service: notify.all_devices
        data:
          title: Ring
          message: There is motion at your backyard
          data:
            tag: motion
            channel: Motion
            clickAction: '/lovelace/camera'
            push:
              thread-id: "motion"

  - id: 6afbd950-7db2-44df-8eb4-d6c46d57f7af
    alias: '[Alert] Low Battery Notification'
    initial_state: 'on'
    trigger:
      - platform: numeric_state
        entity_id:
          - sensor.front_door_battery
          - sensor.backyard_battery
        below: 15
      - platform: numeric_state
        entity_id:
          - sensor.front_door_battery
          - sensor.backyard_battery
        below: 10
    action:
      - service: persistent_notification.create
        data_template:
          message: "{{ trigger.to_state.name }} reported low battery, please charge."
          title: Ring Battery Low
      - service: notify.mobile_app_sm_g960f
        data_template:
          message: "{{ trigger.to_state.name }} reported low battery, please charge."
          title: Ring Battery Low
          data:
            tag: alert
            channel: Alert

  - id: 18bb3b86-f2d8-47d9-908a-b6f1555a15e9
    alias: '[Alert] Play doorbell chime on Echos'
    initial_state: 'off'
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_ding
        from: 'off'
        to: 'on'
    condition:
    action:
      - service: media_player.play_media
        data:
          media_content_id: 'amzn_sfx_doorbell_chime_02'
          media_content_type: sound  
        entity_id: 
          - media_player.master_bedroom
          - media_player.lucas_room
          - media_player.timo_s_room
          - media_player.emilie_s_room

  - id: e684aed6-800b-42c3-8614-3f0079958a8e
    alias: '[General] Day Mode To Evening'
    initial_state: 'on'
    trigger:
      - platform: sun
        event: sunset
        offset: '-00:45:00'

    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.house_mode
          option: Evening

  - id: 1d88c7c6-2720-4854-a2d3-9d48e36171a9
    alias: '[General] Day Mode To Morning'
    initial_state: 'on'
    trigger:
      - platform: sun
        event: sunrise

    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.house_mode
          option: Morning

  - id: 1ee5fa81-d1a5-4f97-9941-61ca679d745c
    alias: '[House] Day Mode To Day'
    initial_state: 'on'
    trigger:
      - platform: time
        at: "09:00:00"

    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.house_mode
          option: Day

  - id: 126f8a12-ce80-45e7-a064-4764643ab0b7
    alias: '[General] Day Mode To Night'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.konnected_alarm
        to: 'armed_home'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.house_mode
          state: 'Evening'
        - condition: time
          after: '22:00:00'
          before: '06:00:00'
        - condition: state
          entity_id: group.household
          state: 'home'
    action:
      # - service: notify.mobile_app_sm_g960f
      #   data:
      #     message: 'It seems like everyone is asleep'
      #     title: 'Good night!'
      #     data:
      #        channel: Alert
      #        tag: alert
      #        sticky: 'true'
      - service: input_select.select_option
        data:
          entity_id: input_select.house_mode
          option: Night

  - id: c93f7aa4-2fd8-4088-88b3-8f07226a7fc5
    alias: '[General] Turn on Rise and Shine scene in the morning'
    condition:
      - condition: numeric_state
        entity_id: sensor.entryway_motion_trigger_count
        below: 1
      - condition: time
        after: '06:00:00'
        before: '10:00:00'
    trigger:
      - platform: state
        entity_id: binary_sensor.entryway
        from: 'off'
        to: 'on'
    action:
      - service: scene.turn_on
        entity_id: scene.rise_and_shine
      # - delay:
      #     seconds: 30
      # - service: media_player.play_media
      #   data:
      #     entity_id: media_player.living_room
      #     media_content_id: good morning
      #     media_content_type: routine

  - id: f1ac429c-e0c6-4859-a3a1-d271136334fa
    alias: '[Alarm] Smoke Detected'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.entryway_nest_protect_smoke_status
        to: emergency
      - platform: state
        entity_id: sensor.hallway_nest_protect_smoke_status
        to: emergency
      - platform: state
        entity_id: sensor.attic_nest_protect_smoke_status
        to: emergency
      - platform: state
        entity_id: sensor.entryway_nest_protect_smoke_status
        to: warning
      - platform: state
        entity_id: sensor.hallway_nest_protect_smoke_status
        to: warning
      - platform: state
        entity_id: sensor.attic_nest_protect_smoke_status
        to: warning
    action:
      - service: cover.open_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c708
      - service: persistent_notification.create
        data:
          message: Smoke detected
          title: Nest Protect
      - service: notify.mobile_app_sm_g960f
        data:
          message: Smoke detected
          title: Nest Protect
          data:
            ttl: 0
            priority: high      
            channel: Alarm
            tag: alarm
            sticky: 'true'
            color: 'red'

  - id: a3f8f81e-db50-480b-87a5-146530934099
    alias: '[Alarm] CO Detected'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.entryway_nest_protect_co_status
        to: emergency
      - platform: state
        entity_id: sensor.hallway_nest_protect_co_status
        to: emergency
      - platform: state
        entity_id: sensor.attic_nest_protect_co_status
        to: emergency
      - platform: state
        entity_id: sensor.entryway_nest_protect_co_status
        to: warning
      - platform: state
        entity_id: sensor.hallway_nest_protect_co_status
        to: warning
      - platform: state
        entity_id: sensor.attic_nest_protect_co_status
        to: warning
    action:
      - service: cover.open_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c964
            - cover.shelly_shsw_25_c4c695
      - service: cover.close_cover
        data:
          entity_id:
            - cover.shelly_shsw_25_c4c708
      - service: persistent_notification.create
        data:
          message: CO detected
          title: Nest Protect
      - service: notify.mobile_app_sm_g960f
        data:
          message: CO detected
          title: Nest Protect
          data:
            ttl: 0
            priority: high      
            channel: Alarm
            tag: alarm
            sticky: 'true'
            color: 'red'

  - id: d28bb847-8061-473b-b632-7a7d684cee78
    alias: '[Alarm] Turn on lights with an emergency'
    trigger:
      - platform: state
        entity_id: sensor.entryway_nest_protect_smoke_status
        to: emergency
      - platform: state
        entity_id: sensor.hallway_nest_protect_smoke_status
        to: emergency
      - platform: state
        entity_id: sensor.attic_nest_protect_smoke_status
        to: emergency
      - platform: state
        entity_id: sensor.entryway_nest_protect_co_status
        to: emergency
      - platform: state
        entity_id: sensor.hallway_nest_protect_co_status
        to: emergency
      - platform: state
        entity_id: sensor.attic_nest_protect_co_status
        to: emergency
    action:
      - service: scene.turn_on
        entity_id: scene.emergency

  - id: d7132414-4610-41a6-9830-8080b980447f
    alias: '[General] Update Notifications'
    initial_state: 'on'
    condition:
      - condition: template
        value_template: '{{ states.sensor.latest_version.state != states.sensor.current_version.state }}'
    trigger:
      - platform: time
        at: 04:00:00
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    action:
      - delay: 00:30:00
      - service: notify.mobile_app_sm_g960f
        data_template:
          title: Home Assistant Update
          message: "Version {{ states.sensor.latest_version.state }} is available!"
          data:
            clickAction: "/hassio/dashboard"
            channel: General
            tag: general


  - id: ef7a15bf-f601-4e75-9e2a-f3a796d37750
    alias: '[Alert] Send notification when amplifier is on when TV is turned off'
    initial_state: 'on'
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.amplifier_on
          state: 'on'
        - condition: state
          entity_id: media_player.living_room_xbox_one
          state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.vieratv_on
        from: 'on'
        to: 'off'
        for: 00:05:00
    action:
      - service: notify.mobile_app_sm_g960f
        data:
          title: TV turned off
          message: TV is turned off, dont't forget to turn of the amplifier and/or Xbox
          data:
            channel: Alert
            tag: alert
      - service: notify.mobile_app_iphone_van_stephanie
        data:
          title: TV turned off
          message: TV is turned off, dont't forget to turn of the amplifier and/or Xbox
          data:
            push:
              thread-id: "alert"
              presentation_options:
                - alert
                - badge
        
  - id: b33f5e19-c075-4bc7-85c0-30c9b759ef38
    alias: '[House] Start WireGuard add-on'
    trigger:
      platform: zone
      entity_id: device_tracker.sm_g960f
      zone: zone.home      
      event: leave
    action:
      - service: hassio.addon_start
        data:
          addon: a0d7b954_wireguard

  - id: 73fc8e0a-e551-496f-b8b9-b9369a861d2a
    alias: '[House] Stop WireGuard add-on'
    trigger:
      platform: zone
      entity_id: device_tracker.sm_g960f
      zone: zone.home      
      event: enter
    action:
      - service: hassio.addon_stop
        data:
          addon: a0d7b954_wireguard