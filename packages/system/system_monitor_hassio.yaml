sensor:
  - platform: command_line
    name: CPU Temperature
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "Â°C"
    value_template: '{{ value | multiply(0.001) }}'

  - platform: version

  - platform: rest
    resource: https://pypi.python.org/pypi/homeassistant/json
    name: Latest Version
    value_template: '{{ value_json.info.version }}'
    scan_interval: 3600

  - platform: command_line
    name: Supervisor updates
    command: 'curl http://supervisor/supervisor/info -H "Authorization: Bearer $(printenv SUPERVISOR_TOKEN)" | jq ''{"newest_version":.data.version_latest,"current_version":.data.version,"addons":[.data.addons[] | select(.version != .installed)]}'''
    value_template: "{{ value_json.addons | length }}"
    json_attributes:
    - newest_version
    - current_version
    - addons

  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_free
      - type: memory_use_percent
      - type: processor_use
      - type: last_boot

  - platform: rest
    resource: http://192.168.178.5:8123/api/hassio/addons/a0d7b954_wireguard/info
    name: Wireguard Add-on
    value_template: '{{ value_json.data.state }}'
    scan_interval: 60
    headers:
      Authorization: !secret llt
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - version
      - version_latest

  - platform: rest
    resource: http://192.168.178.5:8123/api/hassio/addons/a0d7b954_adguard/info
    name: AdGuard Home Add-on
    value_template: '{{ value_json.data.state }}'
    scan_interval: 60
    headers:
      Authorization: !secret llt
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - version
      - version_latest

  - platform: rest
    resource: http://192.168.178.5:8123/api/hassio/addons/a0d7b954_ssh/info
    name: 'SSH & Web Terminal'
    value_template: '{{ value_json.data.state }}'
    scan_interval: 60
    headers:
      Authorization: !secret llt
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - version
      - version_latest

binary_sensor:
  - platform: template
    sensors:
      wireguard_on:
        friendly_name: 'WireGuard Add-on'
        device_class: power
        value_template: >
          {{ is_state('sensor.wireguard', 'started') }}

      adguard_off:
        friendly_name: 'AdGuard Home Add-on'
        device_class: power
        value_template: >
          {{ is_state('sensor.adguard', 'stopped') }}

      ssh_off:
        friendly_name: 'SSH & Web Terminal Add-on'
        device_class: power
        value_template: >
          {{ is_state('sensor.ssh', 'stopped') }}

alert:
  wireguard_on:
    name: WireGuard has started
    entity_id: binary_sensor.wireguard_on
    state: 'on'
    repeat: 360
    can_acknowledge: true
    skip_first: false
    done_message: WireGuard has stopped
    notifiers:
      - mobile_app_sm_g960f
    data:
      tag: 'wireguard-on'

  adguard_off:
    name: AdGuard Home has stopped
    entity_id: binary_sensor.adguard_off
    state: 'on'
    repeat:
      - 15
      - 30
      - 60
    can_acknowledge: true
    skip_first: false
    done_message: AdGuard Home has started
    notifiers:
      - mobile_app_sm_g960f
    data:
      tag: 'adguard-off'

  ssh_off:
    name: 'SSH & Web Terminal has stopped'
    entity_id: binary_sensor.ssh_off
    state: 'on'
    repeat:
      - 15
      - 30
      - 60
    can_acknowledge: true
    skip_first: false
    done_message: 'SSH & Web Terminal has started'
    notifiers:
      - mobile_app_sm_g960f
    data:
      tag: 'ssh-off'

automation:
  - id: b33f5e19-c075-4bc7-85c0-30c9b759ef38
    alias: '[House] Start WireGuard'
    trigger:
      platform: zone
      entity_id: device_tracker.sm_g960f
      zone: zone.home      
      event: leave
    action:
      - service: hassio.addon_start
        data:
          addon: a0d7b954_wireguard

  - id: 73fc8e0a-e551-496f-b8b9-b9369a861d2a
    alias: '[House] Stop WireGuard'
    trigger:
      platform: zone
      entity_id: device_tracker.sm_g960f
      zone: zone.home      
      event: enter
    action:
      - service: hassio.addon_stop
        data:
          addon: a0d7b954_wireguard

  - id: 3e51dc87-54ce-40ff-b4d5-f0316463990e
    alias: '[House] Restart AdGuard Home'
    trigger:
      - platform: time_pattern
        minutes: /10
        seconds: 0
    condition:
      condition: state
      entity_id: binary_sensor.adguard_off
      state: 'on'
    action:
      - service: hassio.addon_start
        data:
          addon: a0d7b954_adguard
