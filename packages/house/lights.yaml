homeassistant:
  customize:
    light.living_room_spot_light:
      friendly_name: Living Room Spot Lights
    light.living_room_wall_light:
      friendly_name: Living Room Wall Lights
    light.living_room_dining_table_light:
      friendly_name: Living Room Dining Table Light       
    light.office_spot_light:
      friendly_name: Office Spot Lights
    sensor.living_room_spot_dimmer_power:
        friendly_name: Living Room Spot Lights
    sensor.living_room_wall_dimmer_power:
      friendly_name: Living Room Wall Lights
    sensor.living_room_dining_table_dimmer_power:
      friendly_name: Living Room Dining Table Light       
    sensor.office_spot_dimmer_power:
        friendly_name: Office Spot Lights

light:
  - platform: group
    name: All Lights
    entities:
      - light.inside_lights
      - light.outside_lights

  - platform: group
    name: Inside Lights
    entities:
      - light.ground_floor_lights
      - light.first_floor_lights
      - light.attic_lights

  - platform: group
    name: Ground Floor Lights
    entities:
      - light.entryway_lights
      - light.kitchen_lights
      - light.living_room_lights
      - light.office_lights

  - platform: group
    name: Living Room Lights
    entities:
      - light.living_room_dining_table_light
      - light.living_room_led_strips
      - light.living_room_painting_light
      - light.living_room_spot_light
      - light.living_room_tv_light
      - light.living_room_wall_light

  - platform: group
    name: Office Lights
    entities:
      - light.office_led_strip
      - light.office_painting_light
      - light.office_spot_light
      - light.office_desk_light

  - platform: group
    name: Kitchen Lights
    entities:
      - light.hood_light
      - light.kitchen_light

  - platform: group
    name: Entryway Lights
    entities:
      - light.entryway_light
      - light.entryway_wall_light

  - platform: group
    name: First Floor Lights
    entities:
      - light.bathroom_light
      - light.hallway_light
      - light.master_bedroom_lights
      - light.timo_room_light
      - light.guestroom_light

  - platform: group
    name: Master Bedroom Lights
    entities:
      - light.master_bedroom_wardrobe_light
      - light.master_bedroom_wall_light
  
  - platform: group
    name: Lucas Room Lights
    entities:
      - light.lucas_room_light
      - light.lucas_room_wall_light
      - light.lucas_room_floor_light
  
  - platform: group
    name: Outside Lights
    entities:
      - light.backyard_garden_light
      - light.backyard_wall_light

script:
  blink_light:
    alias: '[Light] Blink lights'
    sequence:
      repeat:
        count: 10
        sequence:
        - service: light.toggle
          entity_id:
            - light.master_bedroom_wardrobe_light
        - delay:
            milliseconds: 500

  # light_turn_on_light:
  #   alias: '[Light] Turn on light'
  #   sequence:
  #     - service: light.turn_on
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "living_room" -%}
  #             light.living_room
  #           {%- elif room == "master_bedroom" -%}
  #             light.master_bedroom
  #           {%- elif room == "lucas_room" -%}
  #             light.lucas_room
  #           {%- elif room == "timo_s_room" -%}
  #             light.timo_room_light
  #           {%- elif room == "emilie_s_room" -%}
  #             light.emilie_room_light
  #           {%- endif -%}

  # light_turn_off_light:
  #   alias: '[Light] Turn off light'
  #   sequence:
  #     - service: light.turn_off
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "living_room" -%}
  #             light.living_room
  #           {%- elif room == "master_bedroom" -%}
  #             light.master_bedroom
  #           {%- elif room == "lucas_room" -%}
  #             light.lucas_room
  #           {%- elif room == "timo_s_room" -%}
  #             light.timo_room_light
  #           {%- elif room == "emilie_s_room" -%}
  #             light.emilie_room_light
  #           {%- endif -%}

  # light_turn_on_floor_light:
  #   alias: '[Light] Turn on floor light'
  #   sequence:
  #     - service: light.turn_on
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "lucas_room" -%}
  #             light.lucas_room_floor_light
  #           {%- endif -%}

  # light_turn_off_floor_light:
  #   alias: '[Light] Turn off floor light'
  #   sequence:
  #     - service: light.turn_off
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "lucas_room" -%}
  #             light.lucas_room_floor_light
  #           {%- endif -%}

  # light_turn_on_desk_lamp:
  #   alias: '[Light] Turn on desk light'
  #   sequence:
  #     - service: light.turn_on
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "living_room" -%}
  #             light.office_desk_light
  #           {%- endif -%}

  # light_turn_off_desk_lamp:
  #   alias: '[Light] Turn off desk light'
  #   sequence:
  #     - service: light.turn_off
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "living_room" -%}
  #           light.office_desk_light
  #           {%- endif -%}
          

  # light_turn_on_wall_light:
  #   alias: '[Light] Turn on wall light'
  #   sequence:
  #     - service: light.turn_on
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "master_bedroom" -%}
  #             light.master_bedroom_wall_light
  #           {%- endif -%}

  # light_turn_off_wall_light:
  #   alias: '[Light] Turn off wall light'
  #   sequence:
  #     - service: light.turn_off
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "master_bedroom" -%}
  #             light.master_bedroom_wall_light
  #           {%- endif -%}

  # light_turn_on_wardrobe_light:
  #   alias: '[Light] Turn on wardrobe light'
  #   sequence:
  #     - service: light.turn_on
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "master_bedroom" -%}
  #             light.master_bedroom_wardrobe_light
  #           {%- endif -%}

  # light_turn_off_wardrobe_light:
  #   alias: '[Light] Turn off wardrobe light'
  #   sequence:
  #     - service: light.turn_off
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "master_bedroom" -%}
  #             light.master_bedroom_wardrobe_light
  #           {%- endif -%}

  # light_dim_light:
  #   alias: '[Light] Dim light'
  #   sequence:
  #     - service: python_script.dimmer
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "emilie_s_room" -%}
  #             light.emilie_room_light
  #           {%- endif -%}
  #         action: dim_down
  #         level: 75
          
  # light_brighten_light:
  #   alias: '[Light] Brighten light'
  #   sequence:
  #     - service: python_script.dimmer
  #       data_template:
  #         entity_id: >-
  #           {# Use the name of each Echo to determine which room the command likely came from. #}
  #           {%- set room = states("sensor.last_alexa")|replace('media_player.','') -%}

  #           {%- if room == "emilie_s_room" -%}
  #             light.emilie_room_light
  #           {%- endif -%}
  #         action: dim_up
  #         level: 75
        

automation:
  - id: e4519647-e24b-4f1b-8682-51aaa8ce4576
    alias: '[Light] Turn on lights when arriving home at night'
    trigger:
      - platform: state
        entity_id: group.household
        from: not_home
        to: home
    mode: single
    condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: template
        value_template: '{{ state_attr("sun.sun", "elevation") < 0 }}'
    action:
      - service: scene.turn_on
        entity_id: scene.dinner_time  

  - id: a985ba5a-1f99-4695-80dc-4a7b56215781
    alias: '[Light] Turn off hallway light after 10 minutes'
    trigger:
      - platform: state
        entity_id: light.hallway_light
        to: 'on'
        for: "00:10:00"
    mode: single
    action:
      service: light.turn_off
      entity_id: light.hallway_light

  - id: 11e9f0f4a-99b9-427c-85f7-b703a564a511
    alias: '[Light] Turn off entryway light after 10 minutes'
    trigger:
      - platform: state
        entity_id: light.entryway_light
        to: 'on'
        for: "00:10:00"
    mode: single
    action:
      service: light.turn_off
      entity_id: light.entryway_light

  - id: c2aba127-2561-4bcc-9a05-4e6835e817c5
    alias: '[Light] Turn off attic light after 1 minutes'
    trigger:
      - platform: state
        entity_id: binary_sensor.attic_motion_motion
        to: 'off'
    mode: single
    action:
      service: light.turn_off
      entity_id: light.attic_light
            
  - id: 84c6904e-cc77-40ad-8202-52135a53ce17
    alias: '[Light] Turn on attic light when motion'
    condition:
      # - condition: numeric_state
      #   entity_id: sensor.attic_motion_luminosity
      #   below: 101
    trigger:
      - platform: state
        entity_id: binary_sensor.attic_motion_motion
        to: 'on'
    mode: single
    action:
      service: light.turn_on
      entity_id: light.attic_light
  
  - id: d558b383-921e-4740-bafd-9a888b45fa9a
    alias: '[Light] Turn on backyard lights when dark outside'
    trigger:
      - platform: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
    mode: single
    action:
      service: light.turn_on
      data_template:
        entity_id: >
          {% if is_state("cover.backyard_awning", "closed") %}
            light.backyard_wall_light
          {% else %}
            light.backyard_wall_light, light.backyard_garden_light
          {% endif %}

  - id: c94cb345-62ae-44bf-a9e6-0197ffc3ed2c
    alias: '[Light] Turn on backyard wall lights at 6am'
    trigger:
      - platform: time
        at: "06:00:00"
    condition:
      - condition: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
    mode: single
    action:
      - service: light.turn_on
        entity_id: light.backyard_wall_light

  - id: 6d9271c6-b009-4f8f-9ec8-5530604e5b81
    alias: '[Light] Turn on office light when motion in the morning'
    trigger:
      - platform: state
        entity_id: binary_sensor.office
        to: 'on'
    condition:
      - condition: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
      - condition: time
        before: "12:00:00"
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
    mode: single
    action:
      - service: scene.turn_on
        entity_id: scene.work_time

  - id: 6d9271c6-b009-4f8f-9ec8-5530604e5b81
    alias: '[Light] Turn on office light when motion in the morning'
    trigger:
      - platform: state
        entity_id: device_tracker.surface_book_2
        to: home
    condition:
      - condition: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
      - condition: time
        before: "12:00:00"
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
    mode: single
    action:
      - service: scene.turn_on
        entity_id: scene.work_time


  - id: 1802426d-6f61-4dde-ab2c-5cd3b5233243
    alias: '[Light] Turn off backyard lights at midnight'
    trigger:
      - platform: time
        at: "23:59:59"
    mode: single
    action:
      service: light.turn_off
      entity_id:
        - light.backyard_wall_light
        - light.backyard_garden_light

  - id: 34c2fbb7-89d5-48b0-b1db-d12c7a365b01
    alias: '[Light] Turn off backyard wall lights at sunrise'
    trigger:
      - platform: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        above: 0.0
    mode: single
    action:
      service: light.turn_off
      entity_id:
        - light.backyard_wall_light
        - light.backyard_garden_light

  - id: 0f21c88f-c82e-459d-81c5-c5cf170e6279
    alias: '[Light] Turn on backyard lights when motion'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_camera_motion
        to: 'on'
    mode: single
    condition:
      - condition: template
        value_template: '{{ state_attr("sun.sun", "elevation") < 0 }}'
      - condition: time
        after: '00:00:00'
        before: '08:30:00'
    action:
      service: light.turn_on
      entity_id:
        - light.backyard_wall_light
        - light.backyard_garden_light

  - id: 5199be8b-2458-44b0-bd98-6bda33cd96f0
    alias: '[Light] Turn off backyard lights when no motion'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_camera_motion
        to: 'off'
        for: "00:10:00"
    mode: single
    condition:
      - condition: template
        value_template: '{{ state_attr("sun.sun", "elevation") < 0 }}'
      - condition: time
        after: '00:00:00'
        before: '08:30:00'
    action:
      service: light.turn_off
      entity_id:
        - light.backyard_wall_light
        - light.backyard_garden_light

  - id: 9c912ebd-f7a5-46f5-9215-187dda6e2630
    alias: '[Light] Turn off Lucas Room Lights'
    trigger:
      - platform: time_pattern
        minutes: "/10"
    mode: single
    condition:
      - condition: state
        entity_id: person.lucas
        state: not_home
      - condition: state
        entity_id: light.lucas_room
        state: 'on'
    action:
      service: light.turn_off
      entity_id: light.lucas_room

  - id: 1bf4148c-04d3-4ea0-9a68-b14d28fadfee
    alias: '[Light] Flash lights when echo alarm'
    initial_state: false
    trigger:
      - platform: template
        value_template: "{{ as_timestamp(states('sensor.master_bedroom_next_alarm')) - as_timestamp(now()) < 0}}"
    mode: single
    action:
      service: script.turn_on
      entity_id: script.blink_light
      
  - id: b8b0591a-3c88-4867-9180-8f6d541687de
    alias: '[Light] Turn on entryway light when front door ding'
    trigger:
      - platform: state
        entity_id: binary_sensor.doorbell_ding
        from: 'off'
        to: 'on'
    mode: single
    condition:
      - condition: numeric_state
        entity_id: sun.sun
        value_template: "{{ state_attr('sun.sun', 'elevation') }}"
        below: 0.0
    action:
      - service: light.turn_on
        entity_id: light.entryway_light
      - delay: '00:05:00'
      - service: light.turn_off
        entity_id: light.entryway_light

  - id: 34d845d7-1db0-4718-b82a-94b31ec6e8f0
    alias: '[Light] Turn off all lights when away'
    trigger:
      - platform: state
        entity_id: group.household
        from: 'home'
        to: 'not_home'
    mode: single
    action:
      - service: light.turn_off
        entity_id: light.inside_lights

  - id: 2531a04c-9c4b-4911-b251-e2204d25511e
    alias: '[Light] Turn off light when night'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.konnected_alarm
        to: armed_home
    action:
      - service: light.turn_off
        entity_id:
          - light.kitchen_light
          - light.entryway_wall_light
       
  - id: 71e5ccb0-6bc0-4c67-b3d8-9b18ce443897
    alias: '[Scene] Lets relax when away'
    trigger:
      - platform: time
        at: "19:34:56"
    condition:
      - condition: state
        entity_id: group.household
        state: not_home
    action:
      - service: scene.turn_on
        data:
          entity_id: scene.relax_time    

  - id: 6f2dde39-7084-4cc3-99df-95afccfbacff
    alias: '[Scene] Bedtime when away'
    trigger:
      - platform: time
        at: "22:44:56"
    condition:
      - condition: state
        entity_id: group.household
        state: not_home
    action:
      - service: scene.turn_on
        data:
          entity_id: scene.bed_time              

  - id: 05769c02-8e2c-4f61-a43d-9b1f7851dc79
    alias: '[Light] Turn off living room light when working at daytime'
    trigger:
      - platform: event
        event_type: call_service
        event_data:
          service_data:
            entity_id: scene.work_time
          domain: scene
          service: turn_on
    condition:
      - condition: template
        value_template: "{{ state_attr('sun.sun', 'elevation') > 0 }}"
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
      - condition: not
        conditions:
          - condition: template
            value_template: '{{ now().isoweekday()==3 or now().isoweekday()==5 }}'
          - condition: state
            entity_id: person.stephanie
            state: home
    action:
      - service: light.turn_off
        entity_id:
          - light.entryway_light
          - light.entryway_wall_light
          - light.kitchen_light
          - light.living_room_dining_table_light
          - light.living_room_wall_light
          - light.living_room_spot_light
          - light.living_room_led_strips
          - light.living_room_painting_light
          - light.living_room_tv_light

  - id: 84b25eaf-94bc-4518-80f2-8fd462fa9fe1
    alias: '[Light] Turn off all lights in the morning during weekdays'
    trigger:
      - platform: time
        at: "09:30:00"
    mode: single
    condition:
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
    action:
      service: light.turn_off
      entity_id:
        - light.living_room
        - light.attic_light
        - light.entryway_light
        - light.entryway_wall_light
        - light.hallway_light
        - light.hood_light
        - light.kitchen_light
        - light.master_bedroom_wall_light
        - light.master_bedroom_wardrobe_light
        - light.office_led_strip
        - light.office_spot_light
        - light.guestroom_light
      
  - id: fbc332c2-bd1c-488e-9dcd-ed542487196e
    alias: '[Light] Turn off all lights in the morning during weekend'
    trigger:
      - platform: time
        at: "11:00:00"
    mode: single
    condition:
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'off'
    action:
      service: light.turn_off
      entity_id:
        - light.all_lights
    