homeassistant:
  customize:
    binary_sensor.entryway_nest_protect_online:
      friendly_name: Entryway Nest Protect
    binary_sensor.hallway_nest_protect_online:
      friendly_name: Hallway Nest Protect
    binary_sensor.attic_nest_protect_online:
      friendly_name: Attic Nest Protect
    sensor.entryway_nest_protect_smoke_status:
      icon: mdi:smoke-detector
    sensor.hallway_nest_protect_smoke_status:
      icon: mdi:smoke-detector
    sensor.attic_nest_protect_smoke_status:
      icon: mdi:smoke-detector
    sensor.entryway_nest_protect_co_status:
      icon: mdi:smoke-detector
    sensor.hallway_nest_protect_co_status:
      icon: mdi:smoke-detector
    sensor.attic_nest_protect_co_status:
      icon: mdi:smoke-detector

sensor:
  - platform: template
    sensors:
      smoke_co_detection:
        friendly_name: 'Smoke/CO Detection'
        entity_id: sensor.entryway_nest_protect_smoke_status, sensor.hallway_nest_protect_smoke_status, sensor.attic_nest_protect_smoke_status, sensor.entryway_nest_protect_co_status, sensor.hallway_nest_protect_co_status, sensor.attic_nest_protect_co_status
        value_template: >-
          {% if not is_state("sensor.entryway_nest_protect_smoke_status", "Ok") or not is_state("sensor.hallway_nest_protect_smoke_status", "Ok") or not is_state("sensor.attic_nest_protect_smoke_status", "Ok")  %}
            Smoke Detected
          {% elif not is_state("sensor.entryway_nest_protect_co_status", "Ok") or not is_state("sensor.hallway_nest_protect_co_status", "Ok") or not is_state("sensor.attic_nest_protect_co_status", "Ok")  %}
            CO Detected
          {% else %}
            All clear 
          {% endif %}

automation:
  - id: f1ac429c-e0c6-4859-a3a1-d271136334fa
    alias: '[Nest] Smoke/CO Detected'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.smoke_co_detection
        from: 'All clear'
    action:
      - service: persistent_notification.create
        data_template:
          message: "Smoke or CO detected"
          title: Nest Protect
      - service: notify.mobile_app_dennis_galaxy
        data_template:
          message: "Smoke or CO detected"
          title: Nest Protect
