homeassistant:
  customize:
    switch.backyard_siren:
      friendly_name: Backyard Siren
      icon: mdi:alarm-bell
    switch.living_room_do_not_disturb_switch:
      friendly_name: Living Room Echo Dot
    switch.living_room_fire_tv_stick_do_not_disturb_switch:
      friendly_name: Living Room FireTV Stick
    switch.master_bedroom_do_not_disturb_switch:
      friendly_name: Master Bedroom Echo Dot
    switch.master_bedroom_fire_tv_stick_do_not_disturb_switch:
      friendly_name: Master Bedroom FireTV Stick
    switch.lucas_room_do_not_disturb_switch:
      friendly_name: Lucas' Room Echo Dot
    switch.timo_s_room_do_not_disturb_switch:
      friendly_name: Timo's Room Echo Dot
    switch.emilie_s_room_do_not_disturb_switch:
      friendly_name: Emilie's Room Echo Dot

group:
  alexa:
    - media_player.dennis_s_alexa_app_on_surface_pro_4
    - media_player.dennis_s_alexa_apps
    - media_player.dennis_s_alexa_on_cortana
    - media_player.emilie_s_room
    - media_player.living_room
    - media_player.lucas_room
    - media_player.master_bedroom
    - media_player.this_device
    - media_player.timo_s_room
    - media_player.living_room_fire_tv_stick
    - media_player.master_bedroom_fire_tv_stick

sensor:
  - platform: template
    sensors:
        last_alexa:
          entity_id:
          - media_player.living_room
          - media_player.master_bedroom
          - media_player.lucas_room
          - media_player.timo_s_room
          - media_player.emilie_s_room
          value_template: >
            {{ states.media_player | selectattr('attributes.last_called','eq',True) | map(attribute='entity_id') | first }}

automation:
  - id: 80e577ef-0cb7-43b9-a427-2982efdb3003
    alias: '[Alexa] Notification to refresh token'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id:
          - alarm_control_panel.alexa_guard_7514f
          - media_player.living_room
          - media_player.living_room_fire_tv_stick
          - media_player.master_bedroom
          - media_player.master_bedroom_fire_tv_stick
          - media_player.lucas_room
          - media_player.timo_s_room
          - media_player.emilie_s_room
        to: unavailable
    action:
      - service: persistent_notification.create
        data:
          title: Alexa Token
          message: Alexa authentication need refreshing!
      - service: notify.mobile_app_sm_g960f
        data:
          title: Alexa Token
          message: Alexa authentication need refreshing!
          data:
            channel: Alert
            tag: alert
