homeassistant:
  customize:
    switch.backyard_siren:
      friendly_name: Backyard Siren
      icon: mdi:alarm-bell
    switch.living_room_do_not_disturb_switch:
      friendly_name: Living Room Echo Dot
    switch.living_room_fire_tv_stick_do_not_disturb_switch:
      friendly_name: Living Room FireTV Stick
    switch.master_bedroom_do_not_disturb_switch:
      friendly_name: Master Bedroom Echo Dot
    switch.master_bedroom_fire_tv_stick_do_not_disturb_switch:
      friendly_name: Master Bedroom FireTV Stick
    switch.lucas_room_do_not_disturb_switch:
      friendly_name: Lucas' Room Echo Dot
    switch.timo_s_room_do_not_disturb_switch:
      friendly_name: Timo's Room Echo Dot
    switch.emilie_s_room_do_not_disturb_switch:
      friendly_name: Emilie's Room Echo Dot



group:
  alexa:
    - media_player.dennis_s_alexa_app_on_surface_pro_4
    - media_player.dennis_s_alexa_apps
    - media_player.dennis_s_alexa_on_cortana
    - media_player.emilie_s_room
    - media_player.living_room
    - media_player.lucas_room
    - media_player.master_bedroom
    - media_player.this_device
    - media_player.timo_s_room
    - media_player.living_room_fire_tv_stick
    - media_player.master_bedroom_fire_tv_stick

sensor:
  - platform: template
    sensors:
        last_alexa:
          entity_id:
          - media_player.living_room
          - media_player.master_bedroom
          - media_player.lucas_room
          - media_player.timo_s_room
          - media_player.emilie_s_room
          value_template: >
            {{ states.media_player | selectattr('attributes.last_called','eq',True) | map(attribute='entity_id') | first }}

mqtt:
  broker: 127.0.0.1
  username: !secret mqtt_user
  password: !secret mqtt_password
  discovery: true
  discovery_prefix: homeassistant

  birth_message:
    topic: 'hass/status'
    payload: 'online'
    qos: 0
    retain: false

  will_message:
    topic: 'hass/status'
    payload: 'offline'

automation:
  - id: 39c8ea32-61d3-4971-9b20-f07eb370cfe3
    alias: "[Alexa] Enable Do Not Disturb"
    initial_state: 'on'
    trigger:
      - platform: time
        at: "22:00:00"
    action:
      - service: switch.turn_on
        data:
          entity_id:
            - switch.master_bedroom_do_not_disturb_switch
            - switch.master_bedroom_fire_tv_stick_do_not_disturb_switch
            - switch.lucas_room_do_not_disturb_switch
            - switch.timo_s_room_do_not_disturb_switch
            - switch.emilie_s_room_do_not_disturb_switch

  - id: c875f801-c67e-493a-9cf3-643789134ad1
    alias: "[Alexa] Disable Do Not Disturb"
    initial_state: 'on'
    trigger:
      - platform: time
        at: "07:00:00"
    action:
      - service: switch.turn_off
        data:
          entity_id:
            - switch.master_bedroom_do_not_disturb_switch
            - switch.master_bedroom_fire_tv_stick_do_not_disturb_switch
            - switch.lucas_room_do_not_disturb_switch
            - switch.timo_s_room_do_not_disturb_switch
            - switch.emilie_s_room_do_not_disturb_switch

  - id: 2ae00756-b4a9-4068-acc8-c574a8a60fd4
    alias: '[Ring]  Motion in backyard'
    initial_state: 'true'
    trigger:
      - platform: state
        entity_id: binary_sensor.backyard_motion
        to: 'on'
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: alarm_control_panel.konnected_alarm
          state: armed_away
        - condition: state
          entity_id: alarm_control_panel.konnected_alarm
          state: armed_home
    action:
      - service: notify.alexa_media
        data:
          data:
            type: announce
          target:
            - group.alexa
          message: "Motion in the backyard"
      - service: notify.all_devices
        data:
          title: Ring
          message: There is motion at your backyard
          data:
            actions:
              - action: open
                icon: "/local/icons/konnected.png"
                title: Open Home Assistant
            tag: ring_alert
            ttl: 86400
            priority: high      

  - id: 6afbd950-7db2-44df-8eb4-d6c46d57f7af
    alias: '[Ring] Low Battery Notification'
    initial_state: 'on'
    trigger:
      - platform: numeric_state
        entity_id:
          - sensor.front_door_battery
          - sensor.backyard_battery
        below: 15
      - platform: numeric_state
        entity_id:
          - sensor.front_door_battery
          - sensor.backyard_battery
        below: 10
    action:
      - service: persistent_notification.create
        data_template:
          message: "{{ trigger.to_state.name }} reported low battery, please charge."
          title: Ring Battery Low
      - service: notify.mobile_app_sm_g960f
        data_template:
          message: "{{ trigger.to_state.name }} reported low battery, please charge."
          title: Ring Battery Low

  - id: 18bb3b86-f2d8-47d9-908a-b6f1555a15e9
    alias: '[Ring] Play doorbell chime on Echos'
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_ding
        from: 'off'
        to: 'on'
    condition:
    action:
      - service: media_player.play_media
        data_template:
          media_content_id: 'amzn_sfx_doorbell_chime_02'
          media_content_type: sound  
        entity_id: 
          - media_player.living_room
          - media_player.master_bedroom
          - media_player.lucas_room
          - media_player.timo_s_room
          - media_player.emilie_s_room
