konnectedaway:
  alias: 'Konnected Arm'
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.konnectedstatus
        option: armed_away
    - service: alarm_control_panel.alarm_arm_away
      entity_id:
        - alarm_control_panel.konnected_alarm
    - service: alarm_control_panel.alarm_arm_away
      entity_id:
        - alarm_control_panel.alexa_guard_7514f
    - service: climate.set_preset_mode
      entity_id:
        - climate.living_room
      data: {"preset_mode": "away"}
    - service: notify.alexa_media
      data:
        data:
          type: tts
        target:
        - group.alexa
        message: I'll start guarding now

konnectedhome:
  alias: 'Konnected Home'
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.konnectedstatus
        option: armed_home
    - service: alarm_control_panel.alarm_arm_home
      entity_id:
        - alarm_control_panel.konnected_alarm
    - service: alarm_control_panel.alarm_arm_home
      entity_id:
        - alarm_control_panel.alexa_guard_7514f

konnectedstandby:
  alias: 'Konnected Standby'
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.konnectedstatus
        option: disarmed
    - service: alarm_control_panel.alarm_disarm
      entity_id:
        - alarm_control_panel.konnected_alarm
    - service: alarm_control_panel.alarm_disarm
      entity_id:
        - alarm_control_panel.alexa_guard_7514f
    - service: climate.set_preset_mode
      entity_id:
        - climate.living_room
      data: {"preset_mode": "home"}

konnectedpending:
  alias: 'Konnected Pending'
  sequence:
    - service: alarm_control_panel.alarm_trigger
      entity_id: alarm_control_panel.Konnected_Alarm
    - service: notify.alexa_media
      data:
        data:
          type: tts
        target:
          - group.alexa
        message: Motion detected, the alarm will activate shortly. Motion detected, the alarm will activate shortly.

konnectedtrigger:
  alias: 'Konnected Trigger'
  sequence:
    - service: switch.turn_on
      entity_id: switch.siren
    - service: notify.alexa_media
      data:
        data:
          type: tts
        target:
          - group.alexa
        message: Your alarm was activated
    - service: notify.html5
      data:
        title: Konnected
        message: Your alarm was activated
        data:
          actions:
            - action: open
              icon: "/local/icons/konnected.png"
              title: Open Home Assistant
          tag: konnected-alarm-notification
          ttl: 86400
          priority: high      
    - service: notify.notify
      data:
        message: "Your alarm was activated"
        data:
          push:
            badge: 0
            category: konnected_alarm
  
backyardmotion:
  alias: 'Backyard Motion'
  sequence:
    - service: notify.alexa_media
      data:
        data:
          type: tts
        target:
          - group.alexa
        message: "Motion in the backyard"
    - service: notify.html5
      data:
        title: Ring
        message: There is motion at your backyard
        data:
          actions:
            - action: open
              icon: "/local/icons/konnected.png"
              title: Open Home Assistant
          tag: ring_alert
          ttl: 86400
          priority: high      
    - service: notify.notify
      data:
        message: There is motion at your backyard
        data:
          push:
            badge: 0
            category: ring_alert


log_motion:
  alias: Log Motion
  sequence:
    - service: logbook.log
      data_template:
        name: "Motion detected: "
        message: >-
          {{ states[entityid.split('.')[0]][entityid.split('.')[1]].name }}

nest_update_eta:
  alias: Nest Update ETA
  sequence:
    - service: nest.set_eta
      data_template:
        eta: >
          {% if is_state_attr('proximity.home', 'nearest', 'Dennis') %}
            {{ ((( states.sensor.dennis_to_home.state | int) * 60) - 3600) | timestamp_custom('%H:%M:%S') }}
          {% elif is_state_attr('proximity.home', 'nearest', 'Dennis, Stephanie') %}
            {{ ((( states.sensor.dennis_to_home.state | int) * 60) - 3600) | timestamp_custom('%H:%M:%S') }}
          {% elif is_state_attr('proximity.home', 'nearest', 'Stephanie') %}
            {{ ((( states.sensor.stephanie_to_home.state | int) * 60) - 3600) | timestamp_custom('%H:%M:%S') }}
          {% endif %}
        eta_window: 00:01
        trip_id: ETA set by HAS
        structure:
          - Retsinagaard
   
nest_cancel_eta:
  alias: Nest Cancel ETA
  sequence:
    - service: nest.cancel_eta
      data:
        trip_id: ETA set by HAS
        structure:
          - Retsinagaard